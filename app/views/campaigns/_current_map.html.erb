<% if campaign.current_map.present? %>
  <%= content_tag :div,
    class: "flex-1 flex flex-row h-full",
    data: {
      controller: "map",
      "map-id": campaign.current_map.id,
      action: "dragover->map#dragOver"
    } do %>
    <% if admin %>
      <div class="current-map__token-drawer token-drawer" data-target="map.tokenDrawer" data-action="dragover->map#dragOverDrawer drop->map#dropOnDrawer">
        <%= link_to new_map_token_path(campaign.current_map), remote: true, title: "New Token", class: "token new-token-link" do %>
          <span class="token__image token__image-add">+</span>
        <% end %>

        <%= render campaign.current_map.tokens.where(stashed: true) %>
      </div>
    <% end %>
    <%= content_tag :div,
      class: "current-map relative overflow-hidden",
      data: {
        controller: "css-var",
        "map-id": campaign.current_map.id,
        target: "map.image",
        action: "dragover->map#dragOverMap drop->map#dropOnMap mousedown->map#pointTo #{"mousedown->map#moveMap" if admin}",
        x: campaign.current_map.x,
        y: campaign.current_map.y,
        zoom: campaign.current_map.zoom,
        "zoom-amount": campaign.current_map.zoom_amount,
        height: campaign.current_map.height,
        width: campaign.current_map.width,
        "zoom-max": campaign.current_map.zoom_max,
        "css-vars": "x y viewport-x viewport-y width height zoom-amount"
      },
      style: background_image(campaign.current_map.image) do %>
      <div class="current-map__token-container" data-target="map.tokenContainer">
        <%= render campaign.current_map.tokens.where(stashed: false) %>
      </div>
      <div class="current-map__map-name">
        <%= content_tag :h2, campaign.current_map.name %>
      </div>
      <% if admin %>
        <div class="controls w-16 absolute top-0 right-0 m-2 flex justify-center">
          <%= button_tag class: "current-map__zoom-out flex-1 text-center border rounded-l-md h-6 bg-gray-200 cursor-default", data: { target: "map.zoomOut", action: "click->map#zoomOut" } do %>
            -
          <% end %>
          <%= button_tag class: "current-map__zoom-in flex-1 text-center border rounded-r-md h-6 bg-gray-200 cursor-default", data: { target: "map.zoomIn", action: "click->map#zoomIn" } do %>
            +
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% else %>
  <h2>No Current Map</h2>
<% end %>
